name: AVIS Hello Log Persistence
on: [push, workflow_dispatch]

jobs:
  avis-process:
    runs-on: ubuntu-latest
    permissions:
      contents: write # REQUIRED to push back to the repo
    env:
      AVIS_BLOCK: |
        fire-gem-config:
          avis:
            message: "hello"
            status: "active"
            identity: "fire-gem-txt"

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Full history needed for the push

      - name: Create Object and Log
        run: |
          # 1. Create the directory (no longer commented out)
          mkdir -p fire-gem
          
          # 2. Write the object
          echo "$AVIS_BLOCK" > fire-gem/fire-gem.txt
          
          # 3. Verification check
          echo "--- OBJECT VERIFICATION ---"
          cat fire-gem/fire-gem.txt

      - name: Commit and Push to Repository
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          git add fire-gem/fire-gem.txt
          # Only commit if there are changes to avoid workflow errors
          git diff --quiet && git diff --staged --quiet || git commit -m "AVIS: Persisting fire-gem object"
          git push
