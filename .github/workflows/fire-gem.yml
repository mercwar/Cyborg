name: Fire-Gem AVIS Engine
on: [push, workflow_dispatch]

jobs:
  deploy-gem:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Assembly Tools
        run: sudo apt-get update && sudo apt-get install -y nasm binutils

      - name: Initialize Environment
        run: |
          # 1. Create directory if missing
          mkdir -p fire-gem
          
          # 2. Make the script executable
          chmod +x fire-gem/fire-gem.sh
          
          # 3. Create/Clear the log and ensure it is WRITABLE (666)
          # Use 'touch' to create it, then 'chmod 666' so the ASM can write to it
          touch fire-gem/fire-gem.log
          chmod 666 fire-gem/fire-gem.log

      - name: Execute AVIS Loader
        # We redirect BOTH stdout and stderr to the log
        run: ./fire-gem/fire-gem.sh > fire-gem/fire-gem.log 2>&1 || true

      - name: FORCE DEBUG OUTPUT
        # This is the step that fixes the "Empty Log" mystery
        run: |
          echo "--- START OF LOG ---"
          if [ -f fire-gem/fire-gem.log ]; then
            cat fire-gem/fire-gem.log
          else
            echo "FILE NOT FOUND: fire-gem/fire-gem.log"
          fi
          echo "--- END OF LOG ---"
